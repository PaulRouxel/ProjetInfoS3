#include <stdio.h>
#include <stdlib.h>
#include <allegro.h>

/// STRUCTURE DES JOUEURS ///
typedef struct joueur  //Cette structure gerera les donnees de joueurs tout au long de la partie
{
        int communiste;
        int capitaliste;
} t_joueur;



void initialisationAllegro(){
    allegro_init();
    set_color_depth(desktop_color_depth());
    if((set_gfx_mode(GFX_AUTODETECT_WINDOWED,1024,768,0,0))!=0){
        allegro_message("Pb de mode graphique") ;
        allegro_exit();
        exit(EXIT_FAILURE);
    }
    install_keyboard();
    install_mouse();
}

void ChoixDuMode(t_joueur* perso)
{
    BITMAP* accueil;
    accueil = load_bitmap("ecranmodedejeu.bmp",NULL);

    BITMAP* buffer;
    buffer = create_bitmap(SCREEN_W, SCREEN_H);

    //va nous permettre de sortir de la boucle d'affichage lorsqu'un choix est fait
    int next=0;
    int choix=0;

    //boucle d'affichage
    while(next!=1){

        //routine d'affichage
        blit(accueil, buffer, 0, 0, 0, 0,SCREEN_W, SCREEN_H);
        show_mouse(buffer);
        blit(buffer, screen, 0, 0, 0, 0,SCREEN_W, SCREEN_H);
        clear_bitmap(buffer);

        //correspond aux cases de l'ecran
        if((mouse_b&1)&&(mouse_x>=180)&&(mouse_x<=480)&&(mouse_y>=440)&&(mouse_y<=520))
            {
                choix=1;
                next=1;
            }

        //correspond aux cases de l'ecran
        if((mouse_b&1)&&(mouse_x>=571)&&(mouse_x<=837)&&(mouse_y>=440)&&(mouse_y<=520))
            {
                choix=2;
                next=1;
            }
    }

    if(choix==1) // capitaliste
    {
        perso->capitaliste=1;
        perso->communiste=0;
    }

    if(choix==2)
    {
        perso->capitaliste=0;
        perso->communiste=1;
    }
}


void NouvellePartie(t_joueur* perso)
{
    printf("nouvelle partie");
    ChoixDuMode(perso);
}

void ChargerUnePartie(t_joueur* perso)
{
    printf("charger une partie");
}

void AfficherRegles(t_joueur* perso)
{
    printf("afficher regles");
}

void Quitter()
{
    allegro_exit();
    exit(EXIT_FAILURE);
}

void MenuDemarrage(t_joueur* perso)
{
    //BITMAP
    BITMAP* accueil;
    accueil = load_bitmap("ecrandemarrageS3.bmp",NULL);

    BITMAP* buffer;
    buffer = create_bitmap(SCREEN_W, SCREEN_H);

    //va nous permettre de sortir de la boucle d'affichage lorsqu'un choix est fait
    int next=0;
    int choix=0;

    //boucle d'affichage
    while(next!=1){

        //routine d'affichage
        blit(accueil, buffer, 0, 0, 0, 0,SCREEN_W, SCREEN_H);
        show_mouse(buffer);
        blit(buffer, screen, 0, 0, 0, 0,SCREEN_W, SCREEN_H);
        clear_bitmap(buffer);

        //correspond aux cases de l'ecran
        if((mouse_b&1)&&(mouse_x>=340)&&(mouse_x<=630)&&(mouse_y>=220)&&(mouse_y<=300))
            {
                choix=1;
                next=1;
            }

        //correspond aux cases de l'ecran
        if((mouse_b&1)&&(mouse_x>=340)&&(mouse_x<=630)&&(mouse_y>=320)&&(mouse_y<=387))
            {
                choix=2;
                next=1;
            }

        //correspond aux cases de l'ecran
        if((mouse_b&1)&&(mouse_x>=340)&&(mouse_x<=630)&&(mouse_y>=420)&&(mouse_y<=493))
            {
                choix=3;
                next=1;
            }

        //correspond aux cases de l'ecran
        if((mouse_b&1)&&(mouse_x>=340)&&(mouse_x<=630)&&(mouse_y>=512)&&(mouse_y<=586))
            {
                choix=4;
                next=1;
            }
    }

    if(choix==1)
        NouvellePartie(perso);
    if(choix==2)
        ChargerUnePartie(perso);
    if(choix==3)
        AfficherRegles(perso);
    if(choix==4)
        Quitter();

    allegro_exit();
    exit(EXIT_FAILURE);
}






int main()
{
    initialisationAllegro();
    srand(time(NULL));
    t_joueur* homer=NULL;

    MenuDemarrage(homer);

    allegro_exit();
    exit(EXIT_FAILURE);
    return 0;
}
END_OF_MAIN();
